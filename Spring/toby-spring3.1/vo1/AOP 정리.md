# AOP



- AOP의 필요성

  - 핵심적인 부분(시스템의 핵심인 가치와 목적)에 부가적으로 필요한 것들 중 반복적으로 등장하는 로깅, 인코딩, 보안, 에러체크 등의 관심영역들의 추가가 필요하다면?

    ![img](https://velog.velcdn.com/images/platinouss/post/8b56d7fd-37f8-477d-aa79-181913c33608/image.png)

    

  - 위와 같이 횡단 관심사를 모듈화하고 핵심 Logic에서 분리하여 재사용하는 것이 AOP의 목적이다.

    ==> 핵심 기능에 공통 기능(횡단 관심사)을 삽입하는 것.

    ​         핵심 기능의 코드를 수정하지 않으면서 공통 기능의 구현을 추.   		 가하는 것.

  - 만약 Framework가 AOP를 지원하지 않는다면, Business Logic이 작성되어야 하는 부분에 상관없는 코드(부가적 기능들)가 작성되어야 할 것.

    

- AOP란?

  - Aspect Oriented Programming의 약자로 관점 지향 프로그래밍이라고 불린다.

  - 애플리케이션의 핵심적인 기능에서 부가적인 기능을 분리해서 애스펙트라는 독특한 모듈로 만들어서 설계하고 개발하는 방법.

  - 애플리케이션을 다양한 측면에서 독립적으로 모델링하고, 설계하고, 개발할 수 있도록 만들어주는 것임

  - OOP를 돕는 보조적인 기술임.

    

- AOP의 장점

  - 비즈니스 로직 작성시에 트랜잭션 등과 같은 부가적인 로직 을 고려하지 않아도 되서 핵심 기능 개발에만 집중 할 수 있음.
  - 애플리케이션의 전 영역에서 나타날 경우 엄청난 중복코드를 분리하기 때문에 유지보수가 쉬워짐.
  - 비즈니스 로직과 함께 있으면 비즈니스 로직을 이해하기 어려워 지기때문에 분리하는 것이 좋음
  - 비즈니스 로직에 대한 테스트를 쉽게 만들 수 있음.

  

- AOP의 주요 용어

  ![image-20230521092843815](/Users/jangseulgi/Library/Application Support/typora-user-images/image-20230521092843815.png)

  - 타깃 : 부가기능을 부여할 대상 (핵심모듈)

    > ✔️ 스프링 AOP : 런타임 프록시로 구현되므로 항상 프록시이다.

  - 조인 포인트 

    - 프로그램의 실행 내부에서 어드바이스가 적용될 수 있는  모든 위치를 말함.

    > ✔️ 스프링 AOP :  프록시 방식을 사용하므로 조인포인트는 항상 메서드 실행 지점임.

  - 애스펙트 

    - AOP의 기본 모듈
    - 그 자체로 애플리케이션의 핵심 기능을 담고 있진 앟지만, 애플리케이션을 구성하는 중요한 한가지 요소 
    - 부가될 기능을 정의한 Advice 와 어드바이스를 어디에 적용할지를 결정하는 Pointcut을 함께 가짐.

    > ✔️ 스프링 AOP : 트랙잭샨 관리가 가장 좋은 예시 / @Aspect를 사용해서 구현

  - 어드바이스 

    - 타깃에게 제공할 부가기능을 담은 모듈
    - 타깃이 필요없는 순수한 부가 기능.
    - 애스펙트가 무엇을 언제할지를 정의하고 있음.

    > ✔️ 스프링 AOP : 다양한 어드바이스 존재.
    >
    > - Around Advice(@Around) : 메서드 실행전, 후 또는 익셉션 발생 시점.
    > - Before Advice(@Before) : 메서드 호출 전/
    > - After Returning Advice (@AfterReturning) : 메서드가 익셉션 없이 실행된 이후.
    > - After Trowing Advice : 메서드를 실행하는 도중 익셉션이 발생한 경우.
    > - After Advice : 익셉션 발생 여부 상관 없이 메서드 실행 후.

    

  - 포인트컷 : Advice에 적용할 JoinPoint를 선별하는 작업 또는 그 기능을 정의한 모듈 

     ✔️ 스프링 AOP :  조인포인트는 메서드의 실행이므로, 스프링의 포인트 컷은 메서드를 선정하는 기능을 함.

    

    

- AOP를 구현 하는 방법

  1. **컴파일 시점**에 코드에 공통 기능 삽입 

      --> AspectJ 컴파일러

  2. **클래스 로딩 시점**에 바이트 코드에 공통 기능 삽입 

     --> AspectJ 클래스 로더 조작기

  3. **런타임 시점 **에 프록시 객체를 생성하여 공통 기능 삽입

      ✔️ 스프링에서 AOP를 구현하는 방법

      - 컴파일이나 클래스 로더 조작기를 설정하지 않아도 됨.

      - 프록시는 메서드 오버라이딩 개념으로 동작하기 때문에, 스프링 AOP는 메서드 실행시점에만 AOP를 적용할 수 있음.

      - 스프링 AOP는 스프링 컨테이너가 관리할 수 있는 빈에만 AOP를 적용할 수 있음.

        

     > 프록시 ?
     >
     > -  정의 : 자신이 클라이언트가 사용하려고 하는 실제 대상인 것처럼 위장해서 클라이언트의 요청을 받아주는 것(대리인, 대리자)
     >
     >     클라이언트 --> 프록시 --> 타깃
     >
     > -  독립적으로 개발한 부가기능 모듈을 다양한 타깃 오브젝트의 메소드에 다이내믹하게 적용해주기 위해 가장 중요한 역할을 맡고있는 것이 프록시임.
     >
     > - 사용 목적에 따라
     >
     >   1. 클라이언트가 타깃에  접근하는 방법을 제어하기 위해서 --> 프록시 패턴
     >   2. 타깃에 부가적인 기능을 부여해주기 위해서 --> 데코레이터 패턴

  

- 예시

  ```java
  //Aspect 정의
  @Component
  @Aspect
  public class RunningPerf{
    //Pointcut 정의 (메서드 이름이 save~로 시작하는 경우 )
    @Pointcut("execution(* save*(..))")
    private void publicTarget(){
      
    }
    
    //Advice 정의
    @Around("publicTarget()")
    public object measure(ProceedingJoinPoint joinpoint) thrws Throwable{
      //실행시간 측정 코드 작성
    }
    
    
  }
  ```

  

